<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inbounds - V-UI Panel</title>
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/inbounds.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Add new styles for progress bar and online status */
        .traffic-bar {
            width: 100%;
            background-color: #e9ecef;
            border-radius: .25rem;
            height: 10px;
            position: relative;
            overflow: hidden;
        }
        .traffic-bar-fill {
            background-color: #0d6efd;
            height: 100%;
            border-radius: .25rem;
            transition: width 0.3s ease-in-out;
        }
        .traffic-text {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        .online-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        }
        .online-status .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .online-status.online .dot { background-color: var(--status-running); }
        .online-status.online { color: var(--status-running); }
        .online-status.offline .dot { background-color: #ced4da; }
        .online-status.offline { color: var(--text-secondary); }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <h3>V-UI Panel</h3>
            <nav>
                <a href="/dashboard">Overview</a>
                <a href="/inbounds" class="active">Inbounds</a>
                <a href="/panel-settings">Panel Settings</a>
                <a href="#">Xray Config</a>
            </nav>
            <div class="logout">
                <a href="/logout">Log Out</a>
            </div>
        </aside>

        <main class="inbounds-page">
            <h1>Inbounds</h1>
            <div class="action-bar">
                <button class="btn btn-primary" id="add-inbound-btn">+ Add Inbound</button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 5%;"></th>
                            <th style="width: 5%;">ID</th>
                            <th>Remark</th>
                            <th style="width: 10%;">Enabled</th>
                            <th style="width: 10%;">Port</th>
                            <th style="width: 10%;">Protocol</th>
                            <th style="width: 10%;">Clients</th>
                            <th style="width: 15%;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inbounds-table-body">
                        </tbody>
                </table>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="add-inbound-modal">
        <div class="modal-content">
            <div class="modal-header" style="display: flex;">
                <h2>Add Inbound</h2>
                <button class="close-modal-btn" type="button">&times;</button>
            </div>
            <form id="add-inbound-form" class="modal-form">
                <div class="modal-body">
                    <div class="form-row">
                        <label for="inbound-remark">Remark</label>
                        <input type="text" id="inbound-remark" required>
                    </div>
                    <div class="form-row">
                        <label for="inbound-port">Port</label>
                        <input type="number" id="inbound-port" required>
                    </div>
                    <div class="form-row">
                        <label for="inbound-protocol">Protocol</label>
                        <select id="inbound-protocol">
                            <option value="vless" selected>VLESS</option>
                            <option value="vmess">VMess</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="inbound-network">Network</label>
                        <select id="inbound-network">
                            <option value="tcp" selected>TCP</option>
                            <option value="ws">WebSocket</option>
                            <option value="grpc">gRPC</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn">Close</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>
    <div class="modal-overlay" id="add-client-modal">
        <div class="modal-content">
            <div class="modal-header" style="display: flex;">
                <h2>Add Client</h2>
                <button class="close-modal-btn" type="button">&times;</button>
            </div>
            <form id="add-client-form" class="modal-form">
                <div class="modal-body">
                    <input type="hidden" id="client-inbound-id">
                    <div class="form-row">
                        <label for="client-remark">Email (Client Name)</label>
                        <input type="text" id="client-remark" required>
                    </div>
                    <div class="form-row">
                        <label for="client-subscription">Subscription</label>
                        <input type="text" id="client-subscription" list="subscription-list" placeholder="Enter new or select existing" required>
                        <datalist id="subscription-list"></datalist>
                    </div>
                    <div id="new-sub-fields">
                        <div class="form-row">
                            <label for="client-total-mb">Total Flow (MB)</label>
                            <input type="number" id="client-total-mb" placeholder="0 for unlimited">
                        </div>
                         <div class="form-row">
                            <label for="client-expiry-days">Duration (Days)</label>
                            <input type="number" id="client-expiry-days" placeholder="0 for unlimited">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Client</button>
                </div>
            </form>
        </div>
    </div>
    <div class="modal-overlay" id="qr-code-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header" style="display: flex;">
                <h2>QR Codes & Subscription Link</h2>
                <button class="close-modal-btn" type="button">&times;</button>
            </div>
            <div class="modal-body" style="display: flex; gap: 20px; justify-content: space-around; text-align: center;">
                
                <div>
                    <h4>Subscription</h4>
                    <div id="qr-sub-container" style="padding: 10px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 10px; min-width: 220px; min-height: 220px;"></div>
                    <div style="margin-top: 10px;">
                        <input type="text" id="sub-link-text" readonly style="width: 100%; padding: 8px; text-align: center; border: 1px solid var(--border-color); border-radius: 6px; margin-bottom: 5px; background-color: #f8f9fa;">
                        <button id="copy-sub-link-btn" class="btn btn-secondary btn-sm">Copy Link</button>
                    </div>
                </div>

                <div>
                    <h4 id="qr-client-remark">Client Config</h4>
                    <div id="qr-client-container" style="padding: 10px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 10px; min-width: 220px; min-height: 220px;"></div>
                    <div class="qr-host-toggle" style="display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 13px; color: var(--text-secondary);">
                        <span>Use IPv4 for host</span>
                        <label class="switch"><input type="checkbox" id="qr-use-ip-toggle"><span class="slider"></span></label>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="modal-overlay" id="edit-client-modal">
        <div class="modal-content">
            <div class="modal-header" style="display: flex;">
                <h2>Edit Client</h2>
                <button class="close-modal-btn" type="button">&times;</button>
            </div>
            <form id="edit-client-form" class="modal-form">
                <div class="modal-body">
                    <input type="hidden" id="edit-client-id">
                    <div class="form-row">
                        <label for="edit-client-enabled">Status</label>
                        <label class="switch"><input type="checkbox" id="edit-client-enabled"><span class="slider"></span></label>
                    </div>
                    <div class="form-row">
                        <label for="edit-client-total-mb">Traffic Limit (MB)</label>
                        <input type="number" id="edit-client-total-mb" placeholder="0 for unlimited">
                    </div>
                     <div class="form-row">
                        <label for="edit-client-expiry-days">Expires in (Days from now)</label>
                        <input type="number" id="edit-client-expiry-days" placeholder="Leave empty to keep current date">
                    </div>
                    <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--border-color);">
                    <div class="form-row">
                         <label for="edit-client-reset-traffic">Reset Traffic Usage</label>
                         <label class="switch"><input type="checkbox" id="edit-client-reset-traffic"><span class="slider"></span></label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<script src="/static/js/inbounds.js"></script>
</body>
</html>